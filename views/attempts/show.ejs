<% layout('layouts/boilerplate') %>
<!-- Show score, graphs + analysis for attempt -->
<link rel="stylesheet" href="/stylesheets/styles.css" />
<a class="btn btn-sm btn-outline-secondary mb-3" href="/attempts"
  >&laquo; All Attempts</a
>
<h1>Attempt: <%= attempt.test.form %></h1>
<h2 class="text-muted mb-3">
  <b>Date:</b> <%= attempt.dateTaken.toISOString().slice(0, 10)%>
</h2>
<div class="text-center">
  <!-- <div class="row">
    <div class="col">English</div>
    <div class="col">Math</div>
    <div class="col">Reading</div>
    <div class="col">Science</div>
  </div> -->
  <div class="grid grid-cols-4 display-1">
    <div class="col">English: <%= scaled.english %></div>
    <div class="col">Math: <%= scaled.math %></div>
    <div class="col">Reading: <%= scaled.reading %></div>
    <div class="col">Science: <%= scaled.science %></div>
  </div>
  <div class="grid grid-cols-4">
    <div class="col"><%= raw.english %></div>
    <div class="col"><%= raw.math %></div>
    <div class="col"><%= raw.reading %></div>
    <div class="col"><%= raw.science %></div>
  </div>
  <hr />
  <div class="grid grid-cols-4 display-6">
    <div class="col">
      <%= attempt.tagStats.englishStats.skips %>
      <span><img class="thumbnail" src="/assets/skip.png" alt="" /></span>
    </div>
    <div class="col">
      <%= attempt.tagStats.mathStats.skips %>
      <span><img class="thumbnail" src="/assets/skip.png" alt="" /></span>
    </div>
    <div class="col">
      <%= attempt.tagStats.readingStats.skips %>
      <span><img class="thumbnail" src="/assets/skip.png" alt="" /></span>
    </div>
    <div class="col">
      <%= attempt.tagStats.scienceStats.skips %>
      <span><img class="thumbnail" src="/assets/skip.png" alt="" /></span>
    </div>
  </div>
  <div class="grid grid-cols-4 display-6">
    <div class="col">
      <%= attempt.tagStats.englishStats.guesses %>
      <span><img class="thumbnail" src="/assets/guess.png" alt="" /></span>
    </div>
    <div class="col">
      <%= attempt.tagStats.mathStats.guesses %>
      <span><img class="thumbnail" src="/assets/guess.png" alt="" /></span>
    </div>
    <div class="col">
      <%= attempt.tagStats.readingStats.guesses %>
      <span><img class="thumbnail" src="/assets/guess.png" alt="" /></span>
    </div>
    <div class="col">
      <%= attempt.tagStats.scienceStats.guesses %>
      <span><img class="thumbnail" src="/assets/guess.png" alt="" /></span>
    </div>
  </div>
  <div class="grid grid-cols-4 display-6 mb-3">
    <div class="col">
      <%= attempt.tagStats.englishStats.times %>
      <span><img class="thumbnail" src="/assets/late.png" alt="" /></span>
    </div>
    <div class="col">
      <%= attempt.tagStats.mathStats.times %>
      <span><img class="thumbnail" src="/assets/late.png" alt="" /></span>
    </div>
    <div class="col">
      <%= attempt.tagStats.readingStats.times %>
      <span><img class="thumbnail" src="/assets/late.png" alt="" /></span>
    </div>
    <div class="col">
      <%= attempt.tagStats.scienceStats.times %>
      <span><img class="thumbnail" src="/assets/late.png" alt="" /></span>
    </div>
  </div>
  <div class="grid grid-cols-4 display-6">
    <div class="col">
      <%= attempt.tagStats.englishStats.revises %>
      <span><img class="thumbnail" src="/assets/revise.png" alt="" /></span>
    </div>
    <div class="col">
      <%= attempt.tagStats.mathStats.revises %>
      <span><img class="thumbnail" src="/assets/revise.png" alt="" /></span>
    </div>
    <div class="col">
      <%= attempt.tagStats.readingStats.revises %>
      <span><img class="thumbnail" src="/assets/revise.png" alt="" /></span>
    </div>
    <div class="col">
      <%= attempt.tagStats.scienceStats.revises %>
      <span><img class="thumbnail" src="/assets/revise.png" alt="" /></span>
    </div>
  </div>
</div>

<div class="w-4/5 mx-auto mt-4  rounded">
  <!-- Tabs -->
  <ul id="tabs" class="inline-flex w-full px-1 pt-2 ">
    <li class="px-4 py-2 -mb-px font-semibold text-gray-800 border-b-2 border-blue-400 rounded-t opacity-50"><a id="default-tab" href="#first">English</a></li>
    <li class="px-4 py-2 font-semibold text-gray-800 rounded-t opacity-50"><a href="#second">Math</a></li>
    <li class="px-4 py-2 font-semibold text-gray-800 rounded-t opacity-50"><a href="#third">Reading</a></li>
    <li class="px-4 py-2 font-semibold text-gray-800 rounded-t opacity-50"><a href="#fourth">Science</a></li>
  </ul>

  <!-- Tab Contents -->
  <div id="tab-contents">
    <div id="first" class="p-4">
      <div class="grid grid-cols-2">
        <div id="qTypeBarEng" class="mt-3"></div>
  <div id="histEng" class="mt-3"></div>
      </div>
    </div>
    <div id="second" class="hidden p-4">
      <div class="grid grid-cols-2">
        <div id="qTypeBarMath" class="mt-3"></div>
  <div id="histMath" class="mt-3"></div>
      </div>
    </div>
    <div id="third" class="hidden p-4">
      <div class="grid grid-cols-2">
        <div id="qTypeBarRead" class="mt-3"></div>
  <div id="histRead" class="mt-3"></div>
      </div>
    </div>
    <div id="fourth" class="hidden p-4">
      <div class="grid grid-cols-2">
        <div id="qTypeBarSci" class="mt-3"></div>
  <div id="histSci" class="mt-3"></div>
      </div>
    </div>
  </div>
</div>

<div class="mt-3">
  <a class="btn btn-sm btn-success" href="/attempts/<%= attempt._id %>/edit"
    >Edit</a
  >
  <form
    class="d-inline"
    action="/attempts/<%= attempt.id %>?_method=DELETE"
    method="POST"
  >
    <button
          class="
            inline-flex
            text-white
            bg-red-500
            border-0
            py-2
            px-6
            focus:outline-none
            hover:bg-red-600
            rounded
            text-lg
          "
        >
          Delete
        </button>
  </form>
</div>
<table class="table">
  <thead>
    <tr>
      <th scope="col">Section</th>
      <th scope="col">#</th>
      <th scope="col">Topic</th>
      <th scope="col">Type</th>
      <th scope="col">Skip</th>
      <th scope="col">Guess</th>
      <th scope="col">Time</th>
      <th scope="col">Revise</th>
    </tr>
  </thead>
  <!-- https://stackoverflow.com/questions/22057610/uncaught-typeerror-cannot-read-property-value-of-null -->
  <tbody>
    <% for(let section of ['english','math','reading','science']) { %> 
      <% for(let i=0;i<mistakes[section].length;i++) { %>
      <tr>
        <th scope="row"><%= section[0].toUpperCase() + section.slice(1) %></th>
        <td><%= mistakes[section][i].index  %></td>
        <td> <%=  (mistakes[section][i].type||{}).general || "" %> </td>
        <td> <%= (mistakes[section][i].type||{}).name || "" %> </td>
        <td><img class="small" src="<%= attempt.answers[section][mistakes[section][i].index - 1].tags.includes('skip') ? "/assets/check.png" : "" %>" alt=""></td>
        <td><img class="small" src="<%= attempt.answers[section][mistakes[section][i].index - 1].tags.includes('guess') ? "/assets/check.png" : "" %>" alt=""></td>
        <td><img class="small" src="<%= attempt.answers[section][mistakes[section][i].index - 1].tags.includes('noTime') ? "/assets/check.png" : "" %>" alt=""></td>
        <td><img class="small" src="<%= attempt.answers[section][mistakes[section][i].index - 1].tags.includes('revised') ? "/assets/check.png" : "" %>" alt=""></td>
      </tr>
    <% } %>
    <% }  %> 
    
  </tbody>
</table>

<script>
  const topicStats = <%- JSON.stringify(topicStats) %>;
  const mistakes = <%- JSON.stringify(mistakes) %>;
</script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/drilldown.js"></script>
<script src="https://code.highcharts.com/modules/histogram-bellcurve.js"></script>
<script src="/javascripts/attemptShowPage.js"></script>
