<% layout('layouts/boilerplate') %>
<!-- admin section, add resources etc -->
<h1 class="mt-3 text-2xl
    font-bold
    leading-7
    text-gray-900
    sm:text-3xl sm:truncate
    text-center">Edit Question Type</h1>
<form action="/types/<%= type._id %>?_method=PUT" method="POST" novalidate class="validated-form">
  <div class="mb-3">
    <label class="form-label inline-block mb-2 text-gray-700" for="name">Name</label>
    <input
      type="text"
      class="form-control
        block
        w-full
        px-3
        py-1.5
        text-base
        font-normal
        text-gray-700
        bg-white bg-clip-padding
        border border-solid border-gray-300
        rounded
        transition
        ease-in-out
        m-0
        focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none"
      id="name"
      name="questionType[name]"
      value="<%= type.name %>"
      required
    />
  </div>
  <div class="grid grid-cols-2 mb-3">
    <div class="">
      <select name="questionType[section]" id="section" class="form-select appearance-none
      block
      w-full
      px-3
      py-1.5
      text-base
      font-normal
      text-gray-700
      bg-white bg-clip-padding bg-no-repeat
      border border-solid border-gray-300
      rounded
      transition
      ease-in-out
      m-0 mr-0.5
      focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none">
        <option value="" disabled>Select section</option>
        <option <% if (type.section == "English") { %> selected <% } %>  value="English">English</option>
        <option <% if (type.section == "Math") { %> selected <% } %>  value="Math">Math</option>
        <option <% if (type.section == "Reading") { %> selected <% } %> value="Reading">Reading</option>
        <option <% if (type.section == "Science") { %> selected <% } %>  value="Science">Science</option>
      </select>
    </div>
    <div class="">
      <select name="questionType[general]" id="general" class="form-select appearance-none
      block
      w-full
      px-3
      py-1.5
      text-base
      font-normal
      text-gray-700
      bg-white bg-clip-padding bg-no-repeat
      border border-solid border-gray-300
      rounded
      transition
      ease-in-out
      m-0
      focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none">
        <option value="" selected disabled>Select general topic</option>
        <% for (let topic of topics[type.section.toLowerCase()]) { %>
        <option <% if (type.general == topic) { %> selected <% } %>value="<%= topic %>"><%= topic %></option>
        <% } %>
      </select>
    </div>
  </div>
  <h2 class="mb-3 font-medium leading-tight text-2xl mt-2 text-blue-900 underline">Add Resources</h2>
  <div class="mb-3">
    <input
      type="number"
      class="border p-1 rounded outline-none"
      min="0"
      step="1"
      id="resourceCount"
      value=<%= type.resources.length %>
    />
  </div>
  <div class="mb-5" id="resourcesDiv">
      <% for (let i=0;i<type.resources.length;i++) { %> 
        <div class='form-group resourceInput'>
    <label class="form-label inline-block mb-2 text-gray-700" for="resource<%= i %>Name">Name</label>
    <input type="text" id="resource<%= i %>Name" name="questionType[resources][<%= i %>][name]" class="form-control
        block
        w-full
        px-3
        py-1.5
        text-base
        font-normal
        text-gray-700
        bg-white bg-clip-padding
        border border-solid border-gray-300
        rounded
        transition
        ease-in-out
        m-0 mb-3
        focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none" value="<%= type.resources[i].name %>" required>
    <label class="form-label inline-block mb-2 text-gray-700" for="resource<%= i %>Link">Link</label>
    <input type="text" id="resource<%= i %>Link" name="questionType[resources][<%= i %>][link]" class="form-control
        block
        w-full
        px-3
        py-1.5
        text-base
        font-normal
        text-gray-700
        bg-white bg-clip-padding
        border border-solid border-gray-300
        rounded
        transition
        ease-in-out
        m-0 mb-3
        focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none" value="<%= type.resources[i].link %>" required>
    <label class="form-label inline-block mb-2 text-gray-700" for="resource<%= i %>Description">Description</label>
    <input type="text" id="resource<%= i %>Description" name="questionType[resources][<%= i %>][description]" class="form-control
        block
        w-full
        px-3
        py-1.5
        text-base
        font-normal
        text-gray-700
        bg-white bg-clip-padding
        border border-solid border-gray-300
        rounded
        transition
        ease-in-out
        m-0 mb-3
        focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none" value="<%= type.resources[i].description %>" required>
    <select name="questionType[resources][<%= i %>][format]" id="resource<%= i %>Format" class="form-select appearance-none
      block
      w-full
      px-3
      py-1.5
      text-base
      font-normal
      text-gray-700
      bg-white bg-clip-padding bg-no-repeat
      border border-solid border-gray-300
      rounded
      transition
      ease-in-out
      m-0 mb-3
      focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none" required>
        <option value="" disabled>Select section</option>
        <option <% if (type.resources[i].format == "Video") { %> selected <% } %> value="Video">Video</option>
        <option <% if (type.resources[i].format == "Article") { %> selected <% } %> value="Article">Article</option>
        <option <% if (type.resources[i].format == "Text") { %> selected <% } %> value="Text">Text</option>
        <option <% if (type.resources[i].format == "Formula") { %> selected <% } %> value="Formula">Formula</option>
      </select>
      <hr/>
      </div>
        <% } %> 
  </div>
  <button
          class="
            inline-flex
            text-white
            bg-blue-500
            border-0
            py-2
            px-6
            focus:outline-none
            hover:bg-blue-600
            rounded
            text-lg
          "
        >
          Edit
        </button>
</form>

<script>
  const topics = <%- JSON.stringify(topics) %>
</script>
<script src="/javascripts/topicSelector.js"></script>
<script src="/javascripts/resources.js"></script>